[2023-11-17] [Fix] - Corregidos m√∫ltiples errores de runtime relacionados con manejo de cookies y URLs relativas - [AI]
- Actualizado endpoint de user-permissions para usar URL absoluta en fetch
- Corregido endpoint de roles/permissions para usar roleId en lugar de roleName
- Mejorado manejo de cookies en auth/callback/route.ts
- Resueltos problemas de acceso as√≠ncrono a context.params

[2025-05-21] [Feature] - Re-a√±adidos los selects de Producto y Empresa en el formulario de creaci√≥n de Leads - [XX] 
[2025-05-21] [Fix] - Corregido error de Radix UI con valores vac√≠os en selects de Producto y Empresa - [XX] 
[2025-05-21] [Fix] - Mejorada validaci√≥n en API de leads para verificar email √∫nico y eliminar campo notas innecesario - [XX]
[2025-05-21] [Fix] - A√±adido campo de tel√©fono m√≥vil y autenticaci√≥n de usuario en formulario de leads - [XX] 
[2025-04-27] [Schema] - Implementada funcionalidad de reserva con carga de documentos a Supabase Storage - [AI]
[2025-04-28] [Feature] - Implementada funcionalidad de registro de venta con subida de contrato de venta - [AI]
[2025-04-28] [Fix] - Corregido error de referencia 'id is not defined' en p√°ginas de detalle de lead - [AI]
[2025-11-11] [Fix] - Actualizados los API routes para extraer par√°metros de forma segura - [AI]
[2024-10-09] [Fix] - Corregido el tipado de params en las rutas API de leads - [AI]
[2025-05-27] [Schema] - A√±adidos campos description y scheduledFor al modelo Task para notas adicionales y programaci√≥n - [AB]
[2025-05-27] [Feature] - Implementado flujo de dos pasos en creaci√≥n de tareas con selector de fecha/hora y notas - [AB]
[2025-05-27] [Fix] - Corregido problema con la obtenci√≥n del ID de usuario en la creaci√≥n de tareas - [AB]
[2025-05-28] [Schema] - A√±adido campo qualification tipo enum LeadQualification a modelo Lead para calificaci√≥n de leads - [AB]
[2025-05-28] [Feature] - Implementada funcionalidad de calificaci√≥n de leads como Good/Bad - [AB]
[2025-05-28] [Feature] - Actualizado componente principal para filtrar leads marcados como Bad Lead - [AB]
[2025-05-28] [Fix] - Corregido error en API de calificaci√≥n de leads para usar await con params.id - [AB]
[2023-06-19] [Fix] - Corregido el endpoint de calificaci√≥n de leads que no funcionaba correctamente - [CL]
[2023-06-19] [Feature] - Agregada funcionalidad para actualizar la lista de leads inmediatamente despu√©s de calificar como "Bad Lead" - [CL]
[2023-06-19] [Refactor] - Mejorado el sistema de filtrado para incluir isArchived adem√°s de qualification en la lista de leads - [CL]
[2023-06-19] [Schema] - A√±adida propiedad isArchived al tipo LeadWithRelations para TypeScript - [CL]
[2023-06-19] [Schema] - A√±adido campo isFavorite a la tabla Lead con √≠ndice para mejorar rendimiento en filtrado - [CL]
[2023-06-19] [Feature] - Implementado men√∫ de acciones en tarjetas de leads con opciones para ver detalles, editar y marcar favoritos - [CL]
[2023-06-19] [Feature] - Creado componente de edici√≥n de leads similar al de creaci√≥n pero adaptado para actualizaci√≥n - [CL]
[2023-06-19] [Feature] - Mejorada la visualizaci√≥n de informaci√≥n de usuario asignado y pr√≥xima tarea en las tarjetas de leads - [CL]
[2023-06-19] [API] - A√±adido endpoint para actualizar estado de favorito de leads con validaci√≥n Zod - [CL]
[2025-06-01] [Feature] - Implementada b√∫squeda funcional de leads con filtrado en tiempo real - [CL]
[2025-06-01] [Feature] - A√±adidas pesta√±as de filtrado: Sin Tareas, Tareas Hoy y Tareas Vencidas con contadores - [CL]
[2025-06-01] [Refactor] - Eliminado bot√≥n de filtros sin funcionalidad del panel de leads - [CL]
[2025-06-01] [Feature] - Mejorada la visualizaci√≥n de contadores en pesta√±as con indicadores de color - [CL]
[2025-06-01] [Fix] - Optimizada la funci√≥n de filtrado para mejor rendimiento en la visualizaci√≥n de leads - [CL]
[2025-06-02] [Feature] - Implementada funcionalidad del selector de grado de inter√©s para filtrar leads - [CL]
[2025-06-02] [Feature] - A√±adido indicador visual de qualityScore en las tarjetas de leads - [CL]
[2025-06-02] [Fix] - Corregido filtrado de leads seg√∫n su qualityScore - [CL]
[2025-06-02] [Fix] - Optimizado el filtro "Sin Tareas" para verificar correctamente tareas pendientes - [CL]
[2025-06-05] [Fix] - Corregido el filtrado de leads por tareas incorporando tasks en el endpoint de la API - [CL]
[2025-06-05] [Fix] - Optimizada la l√≥gica de filtrado en pesta√±as "Sin Tareas", "Tareas Hoy" y "Tareas Vencidas" - [CL]
[2025-06-05] [API] - A√±adida relaci√≥n de tareas al endpoint de obtenci√≥n de leads para mejor filtrado - [CL]
[2025-06-07] [Feature] - Implementado componente real de tareas pendientes con conexi√≥n a la API - [CL]
[2025-06-07] [API] - A√±adido endpoint para obtener tareas pendientes con informaci√≥n de leads - [CL]
[2025-06-07] [Feature] - A√±adida funcionalidad para completar tareas directamente desde el panel - [CL]
[2025-06-10] [Feature] - Implementadas acciones de lead: Contactar por WhatsApp, Agendar cita directa, Archivar y Eliminar lead - [AB]
[2025-06-10] [Feature] - Agregados di√°logos de confirmaci√≥n para operaciones permanentes (archivar/eliminar) de leads - [AB]
[2025-06-10] [Feature] - Mejorada la integraci√≥n de TaskTypeDialog para permitir selecci√≥n de tipo de tarea - [AB]
[2025-06-10] [Fix] - Corregidos errores de importaci√≥n en componente lead-tasks.tsx para usar hooks del m√≥dulo correcto - [AB]
[2025-04-25] [Fix] - Corregida la subida de documentos en el di√°logo de reservaci√≥n para incluir correctamente las URLs en la solicitud - [QD]
[2025-04-25] [Fix] - Corregida sincronizaci√≥n de estado favorito entre lista de leads y detalle, incluyendo campo favoriteAt - [QD]
[2025-04-26] [Fix] - Corregido problema de sincronizaci√≥n entre componentes al marcar/desmarcar favoritos evitando errores de setState - [QD]
[2025-04-26] [Fix] - Mejorado componente LeadCard para sincronizar cambios de favorito bidireccional entre lista y vista detalle - [QD]
[2024-04-29] [Schema] - Activada la relaci√≥n quotationProducts entre Quotation y Product para guardar productos en cotizaciones - [CP]
[2024-04-29] [Feature] - Actualizado componente quotation-dialog.tsx para guardar los productos seleccionados en la cotizaci√≥n - [CP]
[2024-04-29] [API] - Modificada la API de creaci√≥n de cotizaciones para guardar los productos relacionados - [CP]
[2024-05-15] [Schema] - A√±adido modelo Role para gesti√≥n de roles y permisos - [Dev]
[2024-05-15] [Schema] - Actualizado modelo User con relaci√≥n a Role - [Dev]
[2024-05-15] [Feature] - Creada interfaz para gesti√≥n de usuarios - [Dev]
[2024-05-15] [Feature] - Creada interfaz para gesti√≥n de roles y permisos - [Dev]
[2024-05-15] [Feature] - Actualizada navegaci√≥n del sidebar con secci√≥n de roles - [Dev]
[2024-05-16] [Schema] - A√±adido modelo DashboardSection para gesti√≥n din√°mica de secciones - [Dev]
[2024-05-16] [API] - Implementados endpoints para CRUD de secciones del dashboard - [Dev]
[2024-05-16] [API] - Implementados endpoints para CRUD de roles - [Dev]
[2024-05-16] [Feature] - Implementada estructura de permisos por secciones anidadas - [Dev]
[2024-05-16] [Util] - Creado hook usePermissions para gesti√≥n de permisos en el frontend - [Dev]
[2024-05-16] [Util] - Creadas utilidades para generar estructuras de permisos predefinidas - [Dev]
[2024-05-16] [API] - Implementados endpoints para sembrado de datos iniciales de secciones y roles - [Dev]
[2025-04-26] [Feature] - Implementaci√≥n de sistema de control de acceso basado en roles - [AI]
- Creado middleware para proteger rutas basado en roles
- Desarrollado hook useRolePermissions para obtener y verificar permisos
- Modificado sidebar para mostrar s√≥lo elementos autorizados por rol
- Creado componente ProtectedRoute para envolver rutas protegidas
- Implementado API endpoint para obtener permisos por nombre de rol
- Actualizado auth.ts para incluir funciones de verificaci√≥n de roles
[2025-04-27] [Fix] - Corregido error "Maximum update depth exceeded" en sistema de permisos - [AI]
- Implementada memorizaci√≥n (useCallback, useMemo) en hooks y componentes relacionados con permisos
- Optimizado AppSidebar para evitar bucles de actualizaci√≥n con useMemo
- Protecci√≥n contra condiciones de carrera en useRolePermissions con flag isMounted
- Mejorada funci√≥n filterSidebarByPermissions para manejar casos de error
[2025-06-19] [Refactor] - Migrado sistema de autenticaci√≥n de tabla profiles a tabla users - [AI]
- Actualizado AuthProvider para usar users en lugar de profiles
- Modificado endpoint de API /profile/[id] para obtener datos de users
- Implementado endpoint para creaci√≥n de usuarios con roles obligatorios
- Eliminado registro p√∫blico de usuarios (solo admins pueden crear usuarios)
[2023-08-01] [Fix] - Corregido sistema de autenticaci√≥n completo para evitar ciclos de redirecci√≥n y mejorar validaci√≥n - [AI]
- Implementada validaci√≥n de roles y estado activo de usuario en auth-provider
- Actualizado componente UserAuthForm para mostrar errores espec√≠ficos
- Mejorados mensajes de error en espa√±ol para mejor experiencia de usuario
[2023-08-02] [Fix] - Eliminadas redirecciones problem√°ticas en el layout para evitar errores NEXT_REDIRECT - [AI]
- Reemplazada redirecci√≥n en el layout por componente est√°tico
- Mantenida limpieza de sesi√≥n en auth.ts al detectar problemas
- Corregido manejo de cookies as√≠ncronas en componentes del servidor
[2023-09-15] [Fix] - Corregido error de modificaci√≥n de cookies en layout, trasladando la limpieza de sesi√≥n a una API dedicada - [AI]
[2023-09-16] [Fix] - Creada API para acceso seguro a datos de usuario desde el cliente, evitando consultas directas a la tabla 'users' - [AI]
[2023-09-17] [Feature] - Implementado proceso completo de registro con asignaci√≥n autom√°tica del rol de Super Administrator - [AI]
[2023-09-18] [Fix] - Mejorado endpoint de usuarios para funcionar con y sin autenticaci√≥n mediante par√°metro requireAuth - [AI]
[2023-09-19] [Refactor] - Unificado proceso de autenticaci√≥n para usar exclusivamente la API de usuarios, eliminando consultas directas a Supabase - [AI]
[2023-11-13] [Fix] - Implementado nuevo sistema de autenticaci√≥n con Supabase para componentes de servidor - [AI]
- Reemplazada la funci√≥n createClient por createServerComponentClient para manejo correcto de cookies
- Mejorada la validaci√≥n de sesiones usando getUser() en lugar de getSession()
- Corregido el manejo de redirecciones en el layout del dashboard para prevenir errores NEXT_REDIRECT
- Optimizada la detecci√≥n de sesiones inv√°lidas sin causar errores en el servidor

[2023-11-14] [Fix] - Corregido error de construcci√≥n causado por importar next/headers en componentes cliente - [AI]
- A√±adida directiva "use server" a auth.ts para marcar el m√≥dulo como solo para el servidor
- Creados endpoints API seguros en /api/auth para verificar roles y acceso a rutas
- Implementada librer√≠a server-auth.ts con funciones seguras para componentes cliente
- Refactorizados componentes protected-route.tsx y useRolePermissions.ts para usar las nuevas APIs seguras
- Eliminadas importaciones directas a auth.ts desde componentes cliente

[2023-11-15] [Fix] - Solucionado problema de redirecciones infinitas en pantallas de autenticaci√≥n - [AI]
- Corregido getSupabase() para usar cookies de forma as√≠ncrona con createServerComponentClient
- Mejorado layout de dashboard para mostrar error est√°tico en lugar de redirigir con sesiones inv√°lidas
- Optimizados endpoints de autenticaci√≥n API para retornar respuestas vac√≠as en vez de errores
- Implementado mejor manejo de errores en el hook useRolePermissions

[2023-11-16] [Fix] - Corregido error de relaci√≥n entre users y roles que imped√≠a la autenticaci√≥n - [AI]
- Reemplazada consulta directa a Supabase en auth.ts por uso de API /api/users/[id]
- Actualizado endpoint de usuarios para manejar correctamente par√°metros de forma as√≠ncrona
- Solucionado problema de sincronizaci√≥n entre el schema de Prisma y la estructura de Supabase
- Implementado manejo robusto de errores en el flujo de autenticaci√≥n

[2023-11-16] [Fix] - Solucionado error de URL inv√°lida en la autenticaci√≥n - [AI]
- Corregida la construcci√≥n de URL en auth.ts usando URL API para crear URLs completas y v√°lidas
- Refactorizado manejo de par√°metros en endpoint de usuarios para evitar errores de acceso sincr√≥nico
- Mejorada la compatibilidad entre entornos locales y de producci√≥n mediante variables de entorno

[2023-11-18] [Fix] - Corregidos errores de obtenci√≥n de perfil de usuario y adaptado hook useCurrentUser - [AI]
- Modificado hook useCurrentUser para usar /api/users/[id] en lugar de /api/profile que fallaba
- Adaptado formato de datos entre API de usuarios y modelo de perfil esperado por la aplicaci√≥n
- Corregida URL de cerrar sesi√≥n en ProfileDropdown para usar endpoint funcional 
- Corregido error de tipado en settings-form.tsx para manejar errores correctamente
- Actualizado componente NavUser para usar useCurrentUser en lugar de useAuth
- Traducidos textos del men√∫ de usuario en NavUser a espa√±ol

[2023-11-19] [Fix] - Corregido sistema de permisos anidados para mostrar correctamente secciones como "Administraci√≥n" - [AI]
- Mejorada funci√≥n filterSidebarByPermissions para detectar correctamente permisos de secciones anidadas
- Actualizado hook useRolePermissions para manejar notaci√≥n con punto (admin.roles) en verificaci√≥n de permisos
- Optimizada l√≥gica de filtrado para verificar tanto permisos del padre como del elemento hijo anidado

[2023-11-16] [Refactor] - Mejorado sistema de control de acceso basado en roles. Redireccionamiento a /access-denied en lugar de /dashboard cuando el usuario no tiene permisos. - [AI]

[2023-11-17] [Feature] - Actualizado middleware para implementar verificaci√≥n de permisos basada en datos del usuario - [AI]
- Reemplazado sistema de roles est√°tico por verificaci√≥n din√°mica usando el campo permissions
- Implementada normalizaci√≥n de rutas para extraer secciones principales (/admin/roles -> admin)
- A√±adida verificaci√≥n contra la tabla dashboard_sections para validar secciones
- Mejorado soporte para secciones anidadas con verificaci√≥n de permisos padre-hijo
- Optimizado manejo de errores con redirecci√≥n a /access-denied

[2023-11-18] [Fix] - Mejorada experiencia de usuario en la barra lateral durante carga de permisos - [AI]
- A√±adido estado de carga con esqueletos (skeletons) para mantener estructura consistente
- Eliminada desaparici√≥n repentina de secciones al cargar permisos
- Implementada transici√≥n suave entre estado de carga y sidebar con permisos aplicados

[2023-11-18] [Fix] - Corregido y mejorado sistema de protecci√≥n de rutas en el middleware - [AI]
- Implementado mapeo expl√≠cito entre rutas y claves de permisos para evitar errores
- A√±adida verificaci√≥n m√°s estricta de rutas protegidas como /users
- Mejorada detecci√≥n de rutas anidadas como /admin/roles
- Agregado registro de verificaciones para facilitar diagn√≥stico de problemas de permisos

[2023-11-19] [Fix] - Solucionado problema cr√≠tico con las rutas protegidas en el middleware - [AI]
- Separada expl√≠citamente la verificaci√≥n de rutas API de las rutas de navegaci√≥n
- A√±adidos logs detallados para detectar problemas de intercepci√≥n de rutas
- Mejorado el matcher de rutas para incluir expl√≠citamente /users y otras rutas cr√≠ticas
- Refactorizada la l√≥gica de verificaci√≥n de rutas anidadas para mayor claridad
- Optimizado tratamiento de permisos para evitar condiciones de carrera

[2023-11-20] [Fix] - Corregido error cr√≠tico en middleware que detectaba incorrectamente rutas como p√∫blicas - [AI]
- Modificada la funci√≥n isPublicRoute para tratar la ruta ra√≠z "/" como caso especial
- Actualizado el matcher para excluir expl√≠citamente las rutas /api/
- Implementado manejo espec√≠fico para evitar que todas las rutas se consideren p√∫blicas
- Mejorado el sistema de logging para facilitar la depuraci√≥n de problemas de middleware

[2023-11-21] [Fix] - Solucionado error "permission denied for schema public" en middleware - [AI]
- Reemplazado acceso directo a la base de datos con llamada a API existente
- Implementada construcci√≥n de URL segura con protocolo y host din√°micos
- Mejorado el manejo de permisos para soportar formato de string JSON o objeto
- Optimizado sistema de logging para mejor diagn√≥stico de problemas de permisos

[2023-11-21] [Fix] - Corregido acceso a rutas anidadas de administraci√≥n como /admin/roles - [AI]
- Mejorado algoritmo de verificaci√≥n de permisos para reconocer correctamente permisos anidados
- Implementada verificaci√≥n en dos niveles: permiso directo y permiso padre
- A√±adido soporte expl√≠cito para notaci√≥n con punto (admin.roles)
- Extendido sistema de logging para facilitar depuraci√≥n de problemas de permisos espec√≠ficos

[2023-11-22] [Fix] - Solucionado problema con estructura anidada de permisos para secciones de administraci√≥n - [AI]
- Implementada funci√≥n auxiliar checkPermission para manejar estructuras de permisos complejas
- A√±adido soporte para permisos con formato de anidamiento m√∫ltiple (sections.admin.roles.view)
- Mejorada detecci√≥n de permisos tanto en formato plano como en formato anidado
- Agregado sistema de logs detallado que muestra todas las secciones disponibles y sus permisos
- Implementado diagn√≥stico avanzado para identificar problemas en la estructura de permisos
[2024-09-18] [Feature] - Modificado sistema de registro de usuarios para usar supabase.auth.signUp en lugar de admin.createUser - [QCM]
[2024-09-18] [Feature] - A√±adida selecci√≥n din√°mica de roles en el formulario de registro - [QCM]

[2023-11-17] [API] - Implementado CRUD completo para el m√≥dulo de usuarios - roles, permisos y validaci√≥n -[QS]

[2023-11-17] [Fix] - Mejorada la verificaci√≥n de permisos en API usuarios utilizando roleId y JSON permissions -[QS]

[2023-11-17] [Fix] - Se actualiz√≥ la verificaci√≥n de permisos en m√≥dulo de usuarios para usar roleId y permisos JSON en lugar de nombres de rol -[QS]

[2024-09-18] [Feature] - Actualizada p√°gina de usuarios para usar TanStack Table y a√±adida visualizaci√≥n de contrase√±as - [QCM]
[2024-09-18] [Fix] - Modificado API de usuarios para usar supabaseAdmin en operaciones de administraci√≥n - [QCM]

[2024-09-18] [Feature] - Implementado sistema de generaci√≥n autom√°tica de contrase√±as para nuevos usuarios - [QCM]
[2024-09-18] [API] - Creado endpoint para recuperar contrase√±as almacenadas en memoria del servidor - [QCM]

[2024-09-18] [API] - Restaurado endpoint para recuperar contrase√±as desencriptadas desde la base de datos - [QCM]

[2025-05-05] [Fix] - Mejorada seguridad en manejo de contrase√±as: eliminado campo encPassword de User model, implementado sistema de restablecimiento de contrase√±as - [QL]
[2025-05-05] [Fix] - Ajustado dise√±o de di√°logos de credenciales para mantener consistencia con el tema oscuro de la aplicaci√≥n - [QL]
[2025-05-05] [Feature] - Implementado formulario de edici√≥n de usuarios con gesti√≥n de estado activo y cambio de rol - [QL]

[2025-05-08] [Feature] - Implementada secci√≥n de Administraci√≥n de Leads con configuraciones din√°micas - [BR]
- Creada estructura de UI para Estados de Lead, Categor√≠as de Fuente, Fuentes de Lead y Motivos de Cierre
- A√±adida estructura de carpetas bajo src/app/(dashboard)/admin/leads/ con todas las subsecciones
- Implementadas tablas responsivas con vista previa de datos, b√∫squeda y filtros
- A√±adida funcionalidad visual para reordenaci√≥n de estados de lead
- Configurada estructura para la integraci√≥n posterior con la base de datos
- Preparada la secci√≥n leads-settings para incorporaci√≥n al sidebar

[2023-02-16] [Schema] - A√±adido campo isActive a modelo LeadStatus - [QS]
[2023-02-17] [Fix] - Corregido autocompletado de valores en formulario de edici√≥n de estados - [QS]
[2023-02-17] [Fix] - Implementada asignaci√≥n autom√°tica de displayOrder en nuevos estados - [QS]
[2023-02-17] [UX] - Mejorada UX de estados de lead: eliminado campo de orden del formulario, solo se permite modificaci√≥n mediante flechas en tabla - [QS]

[2023-10-20] [Schema] - Implementaci√≥n del CRUD completo para categor√≠as de fuente (SourceCategory) - [QD]
[2023-10-20] [Feature] - Creaci√≥n de componentes y rutas de API para administrar categor√≠as de fuente - [QD]
[2023-10-20] [Feature] - Implementaci√≥n de interfaz de usuario para categor√≠as de fuente con funcionalidad de b√∫squeda - [QD]

[2023-10-21] [Schema] - Implementaci√≥n del CRUD completo para fuentes de lead (LeadSource) - [QD]
[2023-10-21] [Feature] - Creaci√≥n de componentes y rutas de API para administrar fuentes de lead - [QD]
[2023-10-21] [Feature] - Implementaci√≥n de interfaz de usuario para fuentes de lead con funcionalidad de b√∫squeda y selecci√≥n de categor√≠as - [QD]

[2025-05-09] [Feature] - A√±adida secci√≥n de gesti√≥n de productos con funcionalidad CRUD completa - [AL]
- Creado componente Products para administrar cat√°logo de productos
- Implementada interfaz de usuario con 3 pesta√±as: Informaci√≥n B√°sica, Especificaciones, Precios
- A√±adidos componentes modales para la creaci√≥n de BusinessTypes, Brands y Models in-line
- Creados endpoints API para operaciones CRUD de productos
- Actualizados permisos para SuperAdmin y Admin
- A√±adida entrada en sidebar "Productos" bajo secci√≥n "Administraci√≥n"

[2024-07-05] [Fix] - Corregido error de accesibilidad en ProductsEditDialog agregando DialogTitle al estado de carga - [QC]

[ 2 0 2 5 - 0 5 - 1 2 ]   [ F i x ]   -   C o r r e g i d o   p r o b l e m a   d e   U R L   e n   e n t o r n o   d e   p r o d u c c i Û n   -   [ I R ]  
 [ 2 0 2 3 - 1 1 - 1 3 ]   [ F i x ]   -   C o r r e g i d o   p r o b l e m a   d e   U R L   e n   e n t o r n o   d e   p r o d u c c i Û n   -   [ I R ]  
 